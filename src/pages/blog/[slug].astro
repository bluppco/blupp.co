---
// IMPORTS MARKED
import { marked } from "marked"

// IMPORTS ASTRO LAYOUTS
import Layout from "../../layouts/Layout.astro"
import ContainerBlog from "@/layouts/ContainerBlog.astro"

// IMPORTS ASTRO COMPONENTS
import Header from "@/components/common/header/index.astro"
import Footer from "@/components/common/footer/index.astro"


// HIGHLIGHT JS - THEME - WE CAN CHOOSE A BETTER THESE AS WELL.
// LETS KEEP LOOKING
import "highlight.js/styles/dark.min.css"

// IMPORTS CONSTANTS
import {

	CDN_LINK,
	IMAGE_QUALITY

} from "../../constants/images"

const { slug } = Astro.params

// FETCH URL FROM SERVER AND DISPLAY THE DATA
const data = await fetch( "https://staging.api.blupp.co/blog/" + slug )
const data_json = await data.json()

if( data.status !== 200 ){

    return Astro.redirect("/")

}
const blog = data_json.data
const body_md = marked.parse( blog.md )
---
<Layout
	title={ blog.seo_title }
	description={ blog.seo_description }
	image={ CDN_LINK + blog.cover }
>
	<Header />
	<ContainerBlog>
		<section class="pt-32 md:pt-10 md:pb-10 overflow-hidden">
			<div class="h-96">
				<img src={ CDN_LINK + blog.cover  + "?quality=" + IMAGE_QUALITY } alt="" class="w-full h-full object-cover"/>
			</div>
			<div class="space-y-2 pt-6">
				<h1 class="text-2xl font-bold">{ blog.title }</h1>
				<div class="flex flex-col md:flex-row gap-4 md:items-center">
					<div class="italic text-sm">{ blog.date }</div>
					<div class="flex flex-wrap gap-4 items-center">
						{

							blog.category.map( ( value ) => {

								return(
									<div class="text-sm font-semibold px-2 py-1 rounded bg-slate-50 border">{ value }</div>
								)

							})

						}
					</div>
				</div>
			</div>
			<article class="py-2 markdown" set:html={ body_md }/>
		</section>
	</ContainerBlog>
	<Footer />
</Layout>
<script>

	import hljs from "highlight.js"

	document.addEventListener('DOMContentLoaded', (event) => {

  		document.querySelectorAll('pre code').forEach((block) => {

    		hljs.highlightAll();

  		})

	})

</script>
